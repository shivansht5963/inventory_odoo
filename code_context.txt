// File: accounts/__init__.py

// File: accounts/admin.py
from django.contrib import admin
from django.contrib.auth.admin import UserAdmin as DjangoUserAdmin

from .models import User


@admin.register(User)
class UserAdmin(DjangoUserAdmin):
	list_display = ("email", "username", "role", "is_staff", "is_active")
	list_filter = ("role", "is_staff", "is_superuser", "is_active")
	search_fields = ("email", "username")
	ordering = ("email",)
	fieldsets = DjangoUserAdmin.fieldsets
	add_fieldsets = DjangoUserAdmin.add_fieldsets

// File: accounts/apps.py
from django.apps import AppConfig


class AccountsConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'accounts'

// File: accounts/migrations/0001_initial.py
# Generated by Django 4.2.26 on 2025-11-22 05:17

import django.contrib.auth.models
import django.contrib.auth.validators
from django.db import migrations, models
import django.utils.timezone
import uuid


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('auth', '0012_alter_user_first_name_max_length'),
    ]

    operations = [
        migrations.CreateModel(
            name='User',
            fields=[
                ('password', models.CharField(max_length=128, verbose_name='password')),
                ('last_login', models.DateTimeField(blank=True, null=True, verbose_name='last login')),
                ('is_superuser', models.BooleanField(default=False, help_text='Designates that this user has all permissions without explicitly assigning them.', verbose_name='superuser status')),
                ('username', models.CharField(error_messages={'unique': 'A user with that username already exists.'}, help_text='Required. 150 characters or fewer. Letters, digits and @/./+/-/_ only.', max_length=150, unique=True, validators=[django.contrib.auth.validators.UnicodeUsernameValidator()], verbose_name='username')),
                ('first_name', models.CharField(blank=True, max_length=150, verbose_name='first name')),
                ('last_name', models.CharField(blank=True, max_length=150, verbose_name='last name')),
                ('is_staff', models.BooleanField(default=False, help_text='Designates whether the user can log into this admin site.', verbose_name='staff status')),
                ('is_active', models.BooleanField(default=True, help_text='Designates whether this user should be treated as active. Unselect this instead of deleting accounts.', verbose_name='active')),
                ('date_joined', models.DateTimeField(default=django.utils.timezone.now, verbose_name='date joined')),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('email', models.EmailField(max_length=254, unique=True)),
                ('role', models.CharField(choices=[('admin', 'admin'), ('staff', 'staff')], default='staff', max_length=16)),
                ('api_key', models.CharField(blank=True, max_length=128, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('groups', models.ManyToManyField(blank=True, help_text='The groups this user belongs to.', related_name='accounts_users', to='auth.group', verbose_name='groups')),
                ('user_permissions', models.ManyToManyField(blank=True, help_text='Specific permissions for this user.', related_name='accounts_user_permissions', to='auth.permission', verbose_name='user permissions')),
            ],
            options={
                'indexes': [models.Index(fields=['email'], name='accounts_us_email_74c8d6_idx'), models.Index(fields=['created_at'], name='accounts_us_created_4734df_idx')],
            },
            managers=[
                ('objects', django.contrib.auth.models.UserManager()),
            ],
        ),
    ]

// File: accounts/migrations/__init__.py

// File: accounts/models.py
import uuid

from django.conf import settings
from django.db import models
from django.contrib.auth.models import AbstractUser


class User(AbstractUser):
	"""Custom user model.

	- id is a UUID primary key
	- email is unique
	- role is either 'admin' or 'staff'
	- optional api_key for integrations
	- created_at timestamp
	"""

	ROLE_ADMIN = "admin"
	ROLE_STAFF = "staff"

	ROLE_CHOICES = ((ROLE_ADMIN, "admin"), (ROLE_STAFF, "staff"))

	id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
	email = models.EmailField(unique=True)
	role = models.CharField(max_length=16, choices=ROLE_CHOICES, default=ROLE_STAFF)
	api_key = models.CharField(max_length=128, blank=True, null=True)
	created_at = models.DateTimeField(auto_now_add=True)
	# Override related_name for groups and permissions to avoid reverse accessor clashes
	groups = models.ManyToManyField(
		"auth.Group",
		related_name="accounts_users",
		blank=True,
		help_text="The groups this user belongs to.",
		verbose_name="groups",
	)
	user_permissions = models.ManyToManyField(
		"auth.Permission",
		related_name="accounts_user_permissions",
		blank=True,
		help_text="Specific permissions for this user.",
		verbose_name="user permissions",
	)

	USERNAME_FIELD = "username"
	REQUIRED_FIELDS = ["email"]

	def __str__(self):
		return self.email or self.username

	class Meta:
		indexes = [models.Index(fields=["email"]), models.Index(fields=["created_at"])]

// File: accounts/tests.py
from django.test import TestCase

# Create your tests here.

// File: accounts/views.py
from django.shortcuts import render

# Create your views here.

// File: catelog/__init__.py

// File: catelog/admin.py
from django.contrib import admin

from .models import Product


@admin.register(Product)
class ProductAdmin(admin.ModelAdmin):
	list_display = ("name", "sku", "category", "uom", "reorder_level", "created_at")
	search_fields = ("name", "sku", "category")
	list_filter = ("category",)
	ordering = ("name",)

// File: catelog/apps.py
from django.apps import AppConfig


class CatelogConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'catelog'

// File: catelog/migrations/0001_initial.py
# Generated by Django 4.2.26 on 2025-11-22 05:17

import django.core.validators
from django.db import migrations, models
import uuid


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='Product',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=255)),
                ('sku', models.CharField(max_length=128, unique=True)),
                ('category', models.CharField(blank=True, max_length=128, null=True)),
                ('uom', models.CharField(help_text='Unit of measure', max_length=64)),
                ('reorder_level', models.PositiveIntegerField(default=0, validators=[django.core.validators.MinValueValidator(0)])),
                ('created_at', models.DateTimeField(auto_now_add=True)),
            ],
            options={
                'indexes': [models.Index(fields=['sku'], name='catelog_pro_sku_183184_idx'), models.Index(fields=['created_at'], name='catelog_pro_created_c0d57d_idx')],
            },
        ),
    ]

// File: catelog/migrations/__init__.py

// File: catelog/models.py
import uuid

from django.db import models
from django.core.validators import MinValueValidator


class Product(models.Model):
	"""Product catalog."""

	id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
	name = models.CharField(max_length=255)
	sku = models.CharField(max_length=128, unique=True)
	category = models.CharField(max_length=128, blank=True, null=True)
	uom = models.CharField(max_length=64, help_text="Unit of measure")
	reorder_level = models.PositiveIntegerField(default=0, validators=[MinValueValidator(0)])
	created_at = models.DateTimeField(auto_now_add=True)

	def __str__(self):
		return f"{self.name} ({self.sku})"

	class Meta:
		indexes = [models.Index(fields=["sku"]), models.Index(fields=["created_at"])]

// File: catelog/tests.py
from django.test import TestCase

# Create your tests here.

// File: catelog/views.py
from django.shortcuts import render

# Create your views here.

// File: get_code_context.sh
#!/bin/bash

#!/usr/bin/env powershell
echo "Enter the directory path where you want to create code_context.txt:"
read -r project_dir

project_dir="${project_dir//\\//}"

if [ ! -d "$project_dir" ]; then
  echo "Error: Directory '$project_dir' not found."
  exit 1
fi

output_file="${project_dir}/code_context.txt"

if [ -f "$output_file" ]; then
  rm "$output_file"
fi

ignore_patterns=("static" "fonts" "images" "data" "json-excel-converter" "LICENSE" "data.json" "README.md" "*.db" "*.ico" "*.png" "*.jpg" "*.jpeg" "*.gif" "*.svg" "*.pyc" "__pycache__" "env" "node_modules" "package-lock.json" "package.json" "LICENSE" "*.ini" "*.toml" ".coveragerc" ".gitignore" ".travis.yml" "*.lock" "tests" "*.pdf" "dist" "*.json")

include_extensions=(".py" ".js" ".jsx" ".ts" ".tsx" ".html" ".css" ".json" ".php" ".c" ".cpp" ".java" ".sh")

read_files() {
  local dir="$1"
  for entry in "$dir"/*
  do
    should_ignore=false
    for ignore_pattern in "${ignore_patterns[@]}"; do
      if [[ "$entry" == *"$ignore_pattern" ]]; then
        should_ignore=true
        break
      fi
    done

    if $should_ignore; then
      continue
    fi

    if [ -d "$entry" ]; then
      read_files "$entry"
    elif [ -f "$entry" ]; then
      should_include=false
      for ext in "${include_extensions[@]}"; do
        if [[ "$entry" == *"$ext" ]]; then
          should_include=true
          break
        fi
      done

      if $should_include; then
        relative_path=${entry#"$project_dir/"}
        echo "// File: $relative_path" >> "$output_file"
        cat "$entry" >> "$output_file"
        echo "" >> "$output_file"
      else
        echo "Error: File extension not supported: $entry"
      fi
    fi
  done
}

read_files "$project_dir"
echo "Code context has been saved to ${output_file}"
// File: inventory/__init__.py

// File: inventory/admin.py
from django.contrib import admin

from .models import Stock


@admin.register(Stock)
class StockAdmin(admin.ModelAdmin):
	list_display = ("product", "warehouse", "qty", "created_at", "updated_at")
	search_fields = ("product__name", "product__sku", "warehouse__name")
	list_filter = ("warehouse",)
	raw_id_fields = ("product", "warehouse")
	ordering = ("-updated_at",)

// File: inventory/apps.py
from django.apps import AppConfig


class InventoryConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'inventory'

// File: inventory/migrations/0001_initial.py
# Generated by Django 4.2.26 on 2025-11-22 05:17

import django.core.validators
from django.db import migrations, models
import django.db.models.deletion
import uuid


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('catelog', '0001_initial'),
        ('warehouse', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='Stock',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('qty', models.IntegerField(validators=[django.core.validators.MinValueValidator(0)])),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('product', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='stocks', to='catelog.product')),
                ('warehouse', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='stocks', to='warehouse.warehouse')),
            ],
            options={
                'indexes': [models.Index(fields=['product', 'warehouse'], name='inventory_s_product_112b63_idx'), models.Index(fields=['created_at'], name='inventory_s_created_913bee_idx')],
            },
        ),
        migrations.AddConstraint(
            model_name='stock',
            constraint=models.UniqueConstraint(fields=('product', 'warehouse'), name='unique_product_warehouse'),
        ),
    ]

// File: inventory/migrations/__init__.py

// File: inventory/models.py
import uuid

from django.db import models
from django.core.validators import MinValueValidator
from django.core.exceptions import ValidationError


class Stock(models.Model):
	"""Stock level per product per warehouse.

	- unique per (product, warehouse)
	- qty must be >= 0
	"""

	id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
	product = models.ForeignKey(
		"catelog.Product",
		on_delete=models.PROTECT,
		related_name="stocks",
	)
	warehouse = models.ForeignKey(
		"warehouse.Warehouse",
		on_delete=models.PROTECT,
		related_name="stocks",
	)
	qty = models.IntegerField(validators=[MinValueValidator(0)])
	created_at = models.DateTimeField(auto_now_add=True)
	updated_at = models.DateTimeField(auto_now=True)

	def clean(self):
		if self.qty is None:
			raise ValidationError({"qty": "Quantity must be set"})
		if self.qty < 0:
			raise ValidationError({"qty": "Stock quantity must be >= 0"})

	def save(self, *args, **kwargs):
		# run model validation to ensure qty constraint
		self.full_clean()
		super().save(*args, **kwargs)

	def __str__(self):
		return f"{self.product} @ {self.warehouse}: {self.qty}"

	class Meta:
		constraints = [
			models.UniqueConstraint(fields=["product", "warehouse"], name="unique_product_warehouse"),
		]
		indexes = [models.Index(fields=["product", "warehouse"]), models.Index(fields=["created_at"])]

// File: inventory/tests.py
from django.test import TestCase

# Create your tests here.

// File: inventory/views.py
from django.shortcuts import render

# Create your views here.

// File: inventory_project/__init__.py

// File: inventory_project/asgi.py
"""
ASGI config for inventory_project project.

It exposes the ASGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/howto/deployment/asgi/
"""

import os

from django.core.asgi import get_asgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'inventory_project.settings')

application = get_asgi_application()

// File: inventory_project/settings.py
"""
Django settings for inventory_project project.

Generated by 'django-admin startproject' using Django 5.2.6.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/5.2/ref/settings/
"""

from pathlib import Path

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/5.2/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'django-insecure-wy@sf_4%v!%a&pt6zkbjjs74z4q01_xzfb*si6$6-!n==v-_(^'

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = True

ALLOWED_HOSTS = []


# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'inventory',
    'warehouse',
    'accounts',
    'catelog',
    'operations',
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

ROOT_URLCONF = 'inventory_project.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

WSGI_APPLICATION = 'inventory_project.wsgi.application'


# Database
# https://docs.djangoproject.com/en/5.2/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}


# Password validation
# https://docs.djangoproject.com/en/5.2/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]


# Internationalization
# https://docs.djangoproject.com/en/5.2/topics/i18n/

LANGUAGE_CODE = 'en-us'

TIME_ZONE = 'UTC'

USE_I18N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/5.2/howto/static-files/

STATIC_URL = 'static/'

# Default primary key field type
# https://docs.djangoproject.com/en/5.2/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

// File: inventory_project/urls.py
"""
URL configuration for inventory_project project.

The `urlpatterns` list routes URLs to views. For more information please see:
    https://docs.djangoproject.com/en/5.2/topics/http/urls/
Examples:
Function views
    1. Add an import:  from my_app import views
    2. Add a URL to urlpatterns:  path('', views.home, name='home')
Class-based views
    1. Add an import:  from other_app.views import Home
    2. Add a URL to urlpatterns:  path('', Home.as_view(), name='home')
Including another URLconf
    1. Import the include() function: from django.urls import include, path
    2. Add a URL to urlpatterns:  path('blog/', include('blog.urls'))
"""
from django.contrib import admin
from django.urls import path

urlpatterns = [
    path('admin/', admin.site.urls),
]

// File: inventory_project/wsgi.py
"""
WSGI config for inventory_project project.

It exposes the WSGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/5.2/howto/deployment/wsgi/
"""

import os

from django.core.wsgi import get_wsgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'inventory_project.settings')

application = get_wsgi_application()

// File: manage.py
#!/usr/bin/env python
"""Django's command-line utility for administrative tasks."""
import os
import sys


def main():
    """Run administrative tasks."""
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'inventory_project.settings')
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError(
            "Couldn't import Django. Are you sure it's installed and "
            "available on your PYTHONPATH environment variable? Did you "
            "forget to activate a virtual environment?"
        ) from exc
    execute_from_command_line(sys.argv)


if __name__ == '__main__':
    main()

// File: operations/__init__.py

// File: operations/admin.py
from django.contrib import admin

from .models import (
	Receipt,
	ReceiptItem,
	Delivery,
	DeliveryItem,
	Transfer,
	TransferItem,
	Ledger,
)


class ReceiptItemInline(admin.TabularInline):
	model = ReceiptItem
	extra = 0
	raw_id_fields = ("product",)


class DeliveryItemInline(admin.TabularInline):
	model = DeliveryItem
	extra = 0
	raw_id_fields = ("product",)


class TransferItemInline(admin.TabularInline):
	model = TransferItem
	extra = 0
	raw_id_fields = ("product",)


@admin.register(Receipt)
class ReceiptAdmin(admin.ModelAdmin):
	list_display = ("id", "supplier", "warehouse", "status", "created_by", "created_at")
	search_fields = ("supplier", "created_by__email")
	list_filter = ("status", "warehouse")
	inlines = (ReceiptItemInline,)
	raw_id_fields = ("warehouse", "created_by")


@admin.register(Delivery)
class DeliveryAdmin(admin.ModelAdmin):
	list_display = ("id", "customer", "warehouse", "status", "created_by", "created_at")
	search_fields = ("customer", "created_by__email")
	list_filter = ("status", "warehouse")
	inlines = (DeliveryItemInline,)
	raw_id_fields = ("warehouse", "created_by")


@admin.register(Transfer)
class TransferAdmin(admin.ModelAdmin):
	list_display = ("id", "from_warehouse", "to_warehouse", "status", "created_by", "created_at")
	search_fields = ("from_warehouse__name", "to_warehouse__name", "created_by__email")
	list_filter = ("status",)
	inlines = (TransferItemInline,)
	raw_id_fields = ("from_warehouse", "to_warehouse", "created_by")


@admin.register(Ledger)
class LedgerAdmin(admin.ModelAdmin):
	list_display = ("id", "product", "warehouse", "qty_change", "operation_type", "created_by", "created_at")
	search_fields = ("product__name", "product__sku", "created_by__email")
	list_filter = ("operation_type", "warehouse")
	raw_id_fields = ("product", "warehouse", "created_by")


# register items for direct access if desired
@admin.register(ReceiptItem)
class ReceiptItemAdmin(admin.ModelAdmin):
	list_display = ("id", "receipt", "product", "qty")
	raw_id_fields = ("receipt", "product")


@admin.register(DeliveryItem)
class DeliveryItemAdmin(admin.ModelAdmin):
	list_display = ("id", "delivery", "product", "qty")
	raw_id_fields = ("delivery", "product")


@admin.register(TransferItem)
class TransferItemAdmin(admin.ModelAdmin):
	list_display = ("id", "transfer", "product", "qty")
	raw_id_fields = ("transfer", "product")

// File: operations/apps.py
from django.apps import AppConfig


class OperationsConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'operations'

// File: operations/migrations/0001_initial.py
# Generated by Django 4.2.26 on 2025-11-22 05:17

from django.conf import settings
import django.core.validators
from django.db import migrations, models
import django.db.models.deletion
import uuid


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('catelog', '0001_initial'),
        ('warehouse', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='Delivery',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('customer', models.CharField(max_length=255)),
                ('status', models.CharField(choices=[('Draft', 'Draft'), ('Done', 'Done')], default='Draft', max_length=16)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='deliveries_created', to=settings.AUTH_USER_MODEL)),
                ('warehouse', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='deliveries', to='warehouse.warehouse')),
            ],
        ),
        migrations.CreateModel(
            name='Receipt',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('supplier', models.CharField(max_length=255)),
                ('status', models.CharField(choices=[('Draft', 'Draft'), ('Done', 'Done')], default='Draft', max_length=16)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='receipts_created', to=settings.AUTH_USER_MODEL)),
                ('warehouse', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='receipts', to='warehouse.warehouse')),
            ],
        ),
        migrations.CreateModel(
            name='Transfer',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('status', models.CharField(choices=[('Draft', 'Draft'), ('Done', 'Done')], default='Draft', max_length=16)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='transfers_created', to=settings.AUTH_USER_MODEL)),
                ('from_warehouse', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='transfers_out', to='warehouse.warehouse')),
                ('to_warehouse', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='transfers_in', to='warehouse.warehouse')),
            ],
        ),
        migrations.CreateModel(
            name='ReceiptItem',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('qty', models.PositiveIntegerField(validators=[django.core.validators.MinValueValidator(1)])),
                ('product', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='receipt_items', to='catelog.product')),
                ('receipt', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='items', to='operations.receipt')),
            ],
        ),
        migrations.CreateModel(
            name='Ledger',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('qty_change', models.IntegerField()),
                ('operation_type', models.CharField(choices=[('RECEIPT', 'RECEIPT'), ('DELIVERY', 'DELIVERY'), ('TRANSFER', 'TRANSFER'), ('ADJUSTMENT', 'ADJUSTMENT')], max_length=16)),
                ('reference_id', models.UUIDField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='ledger_created', to=settings.AUTH_USER_MODEL)),
                ('product', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='ledger_entries', to='catelog.product')),
                ('warehouse', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='ledger_entries', to='warehouse.warehouse')),
            ],
        ),
        migrations.CreateModel(
            name='DeliveryItem',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('qty', models.PositiveIntegerField(validators=[django.core.validators.MinValueValidator(1)])),
                ('delivery', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='items', to='operations.delivery')),
                ('product', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='delivery_items', to='catelog.product')),
            ],
        ),
        migrations.CreateModel(
            name='TransferItem',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('qty', models.PositiveIntegerField(validators=[django.core.validators.MinValueValidator(1)])),
                ('product', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='transfer_items', to='catelog.product')),
                ('transfer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='items', to='operations.transfer')),
            ],
            options={
                'indexes': [models.Index(fields=['product'], name='operations__product_c815ba_idx')],
            },
        ),
        migrations.AddIndex(
            model_name='transfer',
            index=models.Index(fields=['created_at'], name='operations__created_07a5f8_idx'),
        ),
        migrations.AddIndex(
            model_name='transfer',
            index=models.Index(fields=['from_warehouse', 'to_warehouse'], name='operations__from_wa_8863c2_idx'),
        ),
        migrations.AddIndex(
            model_name='receiptitem',
            index=models.Index(fields=['product'], name='operations__product_d757c5_idx'),
        ),
        migrations.AddIndex(
            model_name='receipt',
            index=models.Index(fields=['created_at'], name='operations__created_75ebd2_idx'),
        ),
        migrations.AddIndex(
            model_name='receipt',
            index=models.Index(fields=['warehouse'], name='operations__warehou_cec013_idx'),
        ),
        migrations.AddIndex(
            model_name='ledger',
            index=models.Index(fields=['product', 'warehouse'], name='operations__product_8f7498_idx'),
        ),
        migrations.AddIndex(
            model_name='ledger',
            index=models.Index(fields=['created_at'], name='operations__created_fbf18d_idx'),
        ),
        migrations.AddIndex(
            model_name='deliveryitem',
            index=models.Index(fields=['product'], name='operations__product_61892d_idx'),
        ),
        migrations.AddIndex(
            model_name='delivery',
            index=models.Index(fields=['created_at'], name='operations__created_846b73_idx'),
        ),
        migrations.AddIndex(
            model_name='delivery',
            index=models.Index(fields=['warehouse'], name='operations__warehou_7e311e_idx'),
        ),
    ]

// File: operations/migrations/__init__.py

// File: operations/models.py
import uuid

from django.conf import settings
from django.db import models
from django.core.validators import MinValueValidator
from django.core.exceptions import ValidationError


STATUS_DRAFT = "Draft"
STATUS_DONE = "Done"
STATUS_CHOICES = ((STATUS_DRAFT, "Draft"), (STATUS_DONE, "Done"))

OP_RECEIPT = "RECEIPT"
OP_DELIVERY = "DELIVERY"
OP_TRANSFER = "TRANSFER"
OP_ADJUSTMENT = "ADJUSTMENT"
OPERATION_CHOICES = ((OP_RECEIPT, OP_RECEIPT), (OP_DELIVERY, OP_DELIVERY), (OP_TRANSFER, OP_TRANSFER), (OP_ADJUSTMENT, OP_ADJUSTMENT))


class Receipt(models.Model):
	id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
	supplier = models.CharField(max_length=255)
	warehouse = models.ForeignKey(
		"warehouse.Warehouse",
		on_delete=models.PROTECT,
		related_name="receipts",
	)
	status = models.CharField(max_length=16, choices=STATUS_CHOICES, default=STATUS_DRAFT)
	created_by = models.ForeignKey(
		settings.AUTH_USER_MODEL,
		on_delete=models.PROTECT,
		related_name="receipts_created",
	)
	created_at = models.DateTimeField(auto_now_add=True)
	updated_at = models.DateTimeField(auto_now=True)

	def __str__(self):
		return f"Receipt {self.id} - {self.supplier} - {self.status}"

	class Meta:
		indexes = [models.Index(fields=["created_at"]), models.Index(fields=["warehouse"])]


class ReceiptItem(models.Model):
	id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
	receipt = models.ForeignKey(
		Receipt, on_delete=models.CASCADE, related_name="items"
	)
	product = models.ForeignKey(
		"catelog.Product", on_delete=models.PROTECT, related_name="receipt_items"
	)
	qty = models.PositiveIntegerField(validators=[MinValueValidator(1)])

	def __str__(self):
		return f"{self.product} x {self.qty} (Receipt: {self.receipt_id if hasattr(self,'receipt_id') else self.receipt.id})"

	class Meta:
		indexes = [models.Index(fields=["product"])]


class Delivery(models.Model):
	id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
	customer = models.CharField(max_length=255)
	warehouse = models.ForeignKey(
		"warehouse.Warehouse",
		on_delete=models.PROTECT,
		related_name="deliveries",
	)
	status = models.CharField(max_length=16, choices=STATUS_CHOICES, default=STATUS_DRAFT)
	created_by = models.ForeignKey(
		settings.AUTH_USER_MODEL,
		on_delete=models.PROTECT,
		related_name="deliveries_created",
	)
	created_at = models.DateTimeField(auto_now_add=True)
	updated_at = models.DateTimeField(auto_now=True)

	def __str__(self):
		return f"Delivery {self.id} - {self.customer} - {self.status}"

	class Meta:
		indexes = [models.Index(fields=["created_at"]), models.Index(fields=["warehouse"])]


class DeliveryItem(models.Model):
	id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
	delivery = models.ForeignKey(
		Delivery, on_delete=models.CASCADE, related_name="items"
	)
	product = models.ForeignKey(
		"catelog.Product", on_delete=models.PROTECT, related_name="delivery_items"
	)
	qty = models.PositiveIntegerField(validators=[MinValueValidator(1)])

	def __str__(self):
		return f"{self.product} x {self.qty} (Delivery: {self.delivery.id})"

	class Meta:
		indexes = [models.Index(fields=["product"])]


class Transfer(models.Model):
	id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
	from_warehouse = models.ForeignKey(
		"warehouse.Warehouse", on_delete=models.PROTECT, related_name="transfers_out"
	)
	to_warehouse = models.ForeignKey(
		"warehouse.Warehouse", on_delete=models.PROTECT, related_name="transfers_in"
	)
	status = models.CharField(max_length=16, choices=STATUS_CHOICES, default=STATUS_DRAFT)
	created_by = models.ForeignKey(
		settings.AUTH_USER_MODEL,
		on_delete=models.PROTECT,
		related_name="transfers_created",
	)
	created_at = models.DateTimeField(auto_now_add=True)
	updated_at = models.DateTimeField(auto_now=True)

	def clean(self):
		if self.from_warehouse_id == self.to_warehouse_id:
			raise ValidationError({"to_warehouse": "Destination warehouse must differ from source"})

	def __str__(self):
		return f"Transfer {self.id} - {self.from_warehouse} -> {self.to_warehouse} ({self.status})"

	class Meta:
		indexes = [models.Index(fields=["created_at"]), models.Index(fields=["from_warehouse", "to_warehouse"])]


class TransferItem(models.Model):
	id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
	transfer = models.ForeignKey(Transfer, on_delete=models.CASCADE, related_name="items")
	product = models.ForeignKey(
		"catelog.Product", on_delete=models.PROTECT, related_name="transfer_items"
	)
	qty = models.PositiveIntegerField(validators=[MinValueValidator(1)])

	def __str__(self):
		return f"{self.product} x {self.qty} (Transfer: {self.transfer.id})"

	class Meta:
		indexes = [models.Index(fields=["product"])]


class Ledger(models.Model):
	"""Ledger of stock movements. qty_change may be + or - depending on operation."""

	id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
	product = models.ForeignKey(
		"catelog.Product", on_delete=models.PROTECT, related_name="ledger_entries"
	)
	warehouse = models.ForeignKey(
		"warehouse.Warehouse", on_delete=models.PROTECT, related_name="ledger_entries"
	)
	qty_change = models.IntegerField()
	operation_type = models.CharField(max_length=16, choices=OPERATION_CHOICES)
	reference_id = models.UUIDField(null=True, blank=True)
	created_by = models.ForeignKey(
		settings.AUTH_USER_MODEL, on_delete=models.PROTECT, related_name="ledger_created"
	)
	created_at = models.DateTimeField(auto_now_add=True)

	def __str__(self):
		return f"Ledger {self.id} - {self.product} @ {self.warehouse}: {self.qty_change} ({self.operation_type})"

	class Meta:
		indexes = [models.Index(fields=["product", "warehouse"]), models.Index(fields=["created_at"])]

// File: operations/tests.py
from django.test import TestCase

# Create your tests here.

// File: operations/views.py
from django.shortcuts import render

# Create your views here.

// File: warehouse/__init__.py

// File: warehouse/admin.py
from django.contrib import admin

from .models import Warehouse


@admin.register(Warehouse)
class WarehouseAdmin(admin.ModelAdmin):
	list_display = ("name", "location", "created_at")
	search_fields = ("name", "location")
	ordering = ("name",)

// File: warehouse/apps.py
from django.apps import AppConfig


class WarehouseConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'warehouse'

// File: warehouse/migrations/0001_initial.py
# Generated by Django 4.2.26 on 2025-11-22 05:17

from django.db import migrations, models
import uuid


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='Warehouse',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=255)),
                ('location', models.CharField(blank=True, max_length=512, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
            ],
            options={
                'indexes': [models.Index(fields=['name'], name='warehouse_w_name_690490_idx'), models.Index(fields=['created_at'], name='warehouse_w_created_013781_idx')],
            },
        ),
    ]

// File: warehouse/migrations/__init__.py

// File: warehouse/models.py
import uuid

from django.db import models


class Warehouse(models.Model):
	"""Simple warehouse model."""

	id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)
	name = models.CharField(max_length=255)
	location = models.CharField(max_length=512, blank=True, null=True)
	created_at = models.DateTimeField(auto_now_add=True)

	def __str__(self):
		return self.name

	class Meta:
		indexes = [models.Index(fields=["name"]), models.Index(fields=["created_at"])]

// File: warehouse/tests.py
from django.test import TestCase

# Create your tests here.

// File: warehouse/views.py
from django.shortcuts import render

# Create your views here.

